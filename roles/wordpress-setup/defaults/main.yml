site_uses_local_db: "{{ site_env.db_host == 'localhost' }}"
nginx_wordpress_site_conf: wordpress-site.conf.j2
nginx_ssl_path: "{{ nginx_path }}/ssl"

ssl_default_site:
  no_default:
    site_hosts:
      - canonical: example.com
    ssl:
      enabled: true
      provider: self-signed
    multisite: {}

nginx_sites_confs:
  - src: no-default.conf.j2
  - src: ssl.no-default.conf.j2
    enabled: "{{ sites_use_ssl }}"

# HSTS defaults
nginx_hsts_max_age: 31536000
nginx_hsts_include_subdomains: true
nginx_hsts_preload: false

# HSTS helpers
hsts_max_age: "{{ item.value.ssl.hsts_max_age | default(nginx_hsts_max_age) }}"
hsts_include_subdomains: "{{ item.value.ssl.hsts_include_subdomains | default(nginx_hsts_include_subdomains) | ternary('includeSubDomains', None) }}"
hsts_preload: "{{ item.value.ssl.hsts_preload | default(nginx_hsts_preload) | ternary('preload', None) }}"

# Fastcgi cache params
nginx_cache_duration: 30s
nginx_skip_cache_uri: /wp-admin/|/wp-json/|/xmlrpc.php|wp-.*.php|/feed/|index.php|sitemap(_index)?.xml
nginx_skip_cache_cookie: comment_author|wordpress_[a-f0-9]+|wp-postpass|wordpress_no_cache|wordpress_logged_in
nginx_cache_background_update: "on"

# Nginx includes
nginx_includes_templates_path: nginx-includes
nginx_includes_deprecated: roles/wordpress-setup/templates/includes.d
nginx_includes_pattern: "^({{ nginx_includes_templates_path | regex_escape }}|{{ nginx_includes_deprecated | regex_escape }})/(.*)\\.j2$"
nginx_includes_d_cleanup: true

# h5bp helpers
not_dev: "{{ env != 'development' }}"
h5bp: "{{ item.value.h5bp | default({}) }}"
# cross origin
h5bp_cross_origin_requests: "{{ ( h5bp.cross_origin | default({}) ).requests | default(true) }}"
h5bp_cross_origin_resource_timing: "{{ ( h5bp.cross_origin | default({}) ).resource_timing | default(false) }}"
# errors
h5bp_errors_custom_errors: "{{ ( h5bp.errors | default({}) ).custom_errors | default(false) }}"
# internet_explorer
h5bp_internet_explorer_x_ua_compatible: "{{ ( h5bp.internet_explorer | default({}) ).x_ua_compatible | default(true) }}"
# location
h5bp_location_security_file_access: "{{ ( h5bp.location | default({}) ).security_file_access | default(true) }}"
h5bp_location_web_performance_filename_based_cache_busting: "{{ ( h5bp.location | default({}) ).web_performance_filename_based_cache_busting | default(false) }}"
h5bp_location_web_performance_svgz_compression: "{{ ( h5bp.location | default({}) ).web_performance_svgz_compression | default(false) }}"
# security
h5bp_security_content_security_policy: "{{ ( h5bp.security | default({}) ).content_security_policy | default(false) }}"
h5bp_security_referrer_policy: "{{ ( h5bp.security | default({}) ).referrer_policy | default(true) }}"
h5bp_security_strict_transport_security: "{{ ( h5bp.security | default({}) ).strict_transport_security | default(false) }}"
h5bp_security_x_content_type_options: "{{ ( h5bp.security | default({}) ).x_content_type_options | default(true) }}"
h5bp_security_x_frame_options: "{{ ( h5bp.security | default({}) ).x_frame_options | default(true) }}"
h5bp_security_x_xss_protection: "{{ ( h5bp.security | default({}) ).x_xss_protection | default(true) }}"
# web_performance
h5bp_web_performance_cache_expiration: "{{ ( h5bp.web_performance | default({}) ).expiration | default(false) }}"
h5bp_web_performance_cache_file_descriptors: "{{ ( h5bp.web_performance | default({}) ).cache_file_descriptors | default(not_dev) }}"
h5bp_web_performance_pre_compressed_content_brotli: "{{ ( h5bp.web_performance | default({}) ).pre_compressed_content_brotli | default(false) }}"
h5bp_web_performance_pre_compressed_content_gzip: "{{ ( h5bp.web_performance | default({}) ).compressed_content_gzip | default(false) }}"

# PHP FPM
php_fpm_pm_max_children: 10
php_fpm_pm_start_servers: 1
php_fpm_pm_min_spare_servers: 1
php_fpm_pm_max_spare_servers: 3
php_fpm_pm_max_requests: 500
